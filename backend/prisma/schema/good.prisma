/// 商品信息
model Goods {
    id                      String              @id @default(cuid())
    /// 关联部门
    departmentId            String
    department              Department?         @relation(fields: [departmentId], references: [id], onDelete: Cascade)
    departmentName          String // 反范式的冗余字段，用于存储部门名称
    /// 店铺名称 
    shopName                String?
    /// SKU字符串数组
    sku                     String              @unique
    /// 负责人
    responsiblePerson       String?
    /// 货架号
    shelfNumber             String?
    /// 产品图片
    imageUrl                String?
    /// 入仓条码
    inboundBarcode          String?
    /// 产品规格
    spec                    String?
    /// 合格证图
    certificateImageUrl     String?
    /// 进货成本
    purchaseCost            Decimal?            @default(0) @db.Decimal(10, 2)
    /// 最低售价
    minSalePrice            Decimal?            @default(0) @db.Decimal(10, 2)
    /// 快递费用
    expressFee              Decimal?            @default(0) @db.Decimal(10, 2)
    /// 耗材费
    materialCost            Decimal?            @default(0) @db.Decimal(10, 2)
    /// 销售出库费
    salesOutboundFee        Decimal?            @default(0) @db.Decimal(10, 2)
    /// TC 到仓费
    tcToWarehouseFee        Decimal?            @default(0) @db.Decimal(10, 2)
    /// 人工打包费
    manualPackingFee        Decimal?            @default(0) @db.Decimal(10, 2)
    /// 交易服务费比例
    transactionServiceRatio Decimal?            @default(0) @db.Decimal(10, 2)
    /// 佣金比例
    commissionRatio         Decimal?            @default(0) @db.Decimal(10, 2)
    /// 平台推广比例
    platformPromotionRatio  Decimal?            @default(0) @db.Decimal(10, 2)
    /// 货损比例
    lossRatio               Decimal?            @default(0) @db.Decimal(10, 2)
    /// 额外成本
    extraCosts              ExtraCost[]
    /// 变动日志
    changeLogs              GoodChangeLog[]
    /// 京仓库存信息
    jingCangStockInfos      JingCangStockInfo[]
    /// 云仓库存信息
    yunCangStockInfos       YunCangStockInfo[]
    createdAt               DateTime            @default(now())
    updatedAt               DateTime            @updatedAt()
    purchaseDetails         PurchaseDetail[]

    @@map("system_goods")
}

/// 额外成本
model ExtraCost {
    id          String   @id @default(cuid())
    /// 关联商品
    goodId      String
    good        Goods    @relation(fields: [goodId], references: [id], onDelete: Cascade)
    /// 金额
    amount      Decimal  @default(0) @db.Decimal(10, 2)
    /// 描述
    description String?
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt()

    @@map("system_goods_extra_cost")
}

/// 商品信息变动日志
model GoodChangeLog {
    id        String   @id @default(cuid())
    /// 关联商品
    goodId    String?
    good      Goods?   @relation(fields: [goodId], references: [id], onDelete: SetNull)
    /// 操作人
    userId    String?
    username  String // 反范式的冗余字段，用于存储用户名
    user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
    /// 操作内容
    content   String
    createdAt DateTime @default(now())

    @@map("system_goods_change_logs")
}

/// EMG/SKU 映射模型（支持部门隔离）
model EmgSkuMapping {
    id     String @id @default(cuid())
    /// EMG SKU
    emgSku String @unique
    /// 平台SKU
    sku    String @unique

    @@map("system_emg_sku_mapping")
}

/// 京仓库存信息模型
model JingCangStockInfo {
    id                   String   @id @default(cuid())
    /// 关联商品ID
    goodId               String
    /// 关联商品
    good                 Goods    @relation(fields: [goodId], references: [id], onDelete: Cascade)
    /// 所属库房
    warehouse            String
    /// 库存数量
    stockQuantity        Int
    /// 日销量
    dailySalesQuantity   Int
    /// 月销量
    monthlySalesQuantity Int
    /// 补货预警阈值
    reorderThreshold     Int      @default(10)
    /// 滞销天数
    sluggishDays         Int      @default(0)
    /// 创建时间
    createdAt            DateTime @default(now())
    /// 更新时间
    updatedAt            DateTime @updatedAt()

    @@unique([goodId, warehouse])
    @@map("system_jing_cang_stock_info")
}

/// 云仓库存信息模型
model YunCangStockInfo {
    id                     String                @id @default(cuid())
    /// 关联商品ID
    goodId                 String                @unique()
    /// 关联商品
    good                   Goods                 @relation(fields: [goodId], references: [id], onDelete: Cascade)
    /// 关联库存池
    yunCangInventoryPool   YunCangInventoryPool? @relation(fields: [yunCangInventoryPoolId], references: [id])
    /// 关联库存池ID
    yunCangInventoryPoolId String?
    /// 日销量
    dailySalesQuantity     Int
    /// 月销量
    monthlySalesQuantity   Int
    /// 补货预警阈值
    reorderThreshold       Int                   @default(10)
    /// 滞销天数
    sluggishDays           Int                   @default(0)
    /// 创建时间
    createdAt              DateTime              @default(now())
    /// 更新时间
    updatedAt              DateTime              @updatedAt()

    @@map("system_yun_cang_stock_info")
}

///  云仓物理库存池
model YunCangInventoryPool {
    id         String             @id @default(cuid())
    /// 真实的物理库存数量
    quantity   Int                @default(0)
    /// 反向关系：查看这个库存池被哪些商品(StockInfo)引用了
    stockInfos YunCangStockInfo[]
    createdAt  DateTime           @default(now())
    updatedAt  DateTime           @updatedAt()

    @@map("system_yun_cang_stock_inventory_pool")
}

/// 采购订单模型
model PurchaseOrder {
    id                      String           @id @default(cuid())
    /// 采购批次号
    purchaseBatchNumber     String           @unique
    /// 部门确认状态（部门确认后，采购详情无法进行二次编辑）
    departmentConfirmStatus Boolean          @default(false)
    /// 财务确认状态（仅状态标记作用，不影响任何业务逻辑）
    financeConfirmStatus    Boolean          @default(false)
    /// 采购详情
    purchaseDetails         PurchaseDetail[]
    createdAt               DateTime         @default(now())
    updatedAt               DateTime         @updatedAt()

    @@map("system_purchase_order")
}

/// 采购详情模型
model PurchaseDetail {
    id                  String        @id @default(cuid())
    /// 关联采购订单
    purchaseOrderId     String
    purchaseOrder       PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
    /// 关联商品
    goodId              String
    good                Goods         @relation(fields: [goodId], references: [id], onDelete: Cascade)
    /// 采购数量
    quantity            Int
    /// 采购金额
    purchaseAmount      Decimal       @default(0) @db.Decimal(10, 2)
    /// 采购订单号
    purchaseOrderNumber String?
    /// 快递单号
    expressNo           String?

    @@map("system_purchase_detail")
}
